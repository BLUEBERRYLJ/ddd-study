# 3장 도메인 복잡성 관리

- 목표: 유비쿼터스 언어를 사용하여 소프트웨어 설계의 의사결정을 내리는 것
- 유비쿼터스 언어는 도메인 전문가의 멘탈 모델을 반영해야 하며,
- 1.**명확**하고 2. **일관성** (각 언어는 하나의 의미를 가져야 한다)이 있어야 한다.

---
### 일관성 없는 모델
예시: 텔레마케팅 회사
- 리드(lead) 라는 용어가 각 부서에서 다른 의미로 사용된다.
    - 마케팅 부서: 온라인 광고를 통해 잠재고객의 연락처 정보를 수신하는 이벤트
    - 영업 부서: 영업 프로세스(잠재고객이 제품이나 서비스를 구매하도록 유도하는 역할)의 전체 수명주기 (이벤트x, 장기적으로 진행되는 과정)
- 언어의 모호성
    - 유비쿼터스 언어의 각 용어는 하나의 의미를 가져야 한다는 일관성을 깨뜨린다.
    - 부서와 도메인 사이의 '리드'의 멘탈 모델의 차이
    - 소스코드는 모호성에 잘 대처하지 못한다.
        - over-engineering : 영업 부서의 복잡한 모델을 마케팅 부서에 적용 (불필요한 세부 사항/행동)
        - under-engineering: 마케팅 관점에 따라 영업 프로세스를 관리 / 최적화
    - 전통적 솔루션: 모든 종류의 문제에 사용할 수 있는 단일 모델 설계 (ERD)

**솔루션  1** - **단일 모델** 사용 - ERD 생성
- 단점: 복잡성
    - 관련 없는 세부사항을 필터링하는 복잡성
    - 필요한 것을 찾는 복잡성
    - 데이터를 일관된 상태로 유지해야 하는 복잡성

**솔루션 2 - 접두사 추가**
- '마케팅 리드', '영업 리드'  와 같이 문제 용어 앞에 접두사 추가
- 단점
    - 인지부하 유발: 충돌하는 모델을 계속해서 구현할수록 실수 유발
    - 모델의 구현이 유비쿼터스 언어와 일치하지 않는다.

-> 도메인 주도 설계 패턴인 바운디드 컨텍스트 등장

---
### 바운디드 컨텍스트란
**유비쿼터스 언어의 일관성이 유지되는 경계** :
유비쿼터스 언어와 해당 언어가 나타내는 모델의 적용 가능성을 규정하는 것.
유비쿼터스 언어의 용어, 원칙, 비즈니스 규칙은 해당 바운디드 컨텍스트 내에서만 일관성이 있다.

**솔루션**

유비쿼터스 언어를 여러 개의 작은 언어로 나눈 다음, 각 언어를 적용할 수 있는 명시적인 바운디드 컨텍스트에 할당
- 마케팅 컨텍스트의 리드(이벤트), 영업 컨텍스트의 리드(복잡한 엔티티)로 분리
- 각 바운디드 컨텍스트에서 단일 의미를 갖는 한, 세분화된 유비쿼터스 언어 각각은 **일관성**을 띄며, 도메인 전문가의 **멘탈 모델**을 따를 수 있다.

#### 모델 경계
모델
- 세계의 복사본 X, 복잡한 시스템을 이해하는데 도움을 주기 위해 구조화한 것.
- 목적: **해결하고자 하는 문제**
- 경계 없이 존재할 수 없다
- e.g) 지도: 항공, 지형, 지하철 등 특정 컨텍스트 존재 /  지도는 특정 목적 범위 내에서만 유용하고 일관성이 있다.

#### 정제된 유비쿼터스 언어
- 보편적으로 바운디드 컨텍스트 경계 안에서만 적용
- 바운디드 컨텍스트에 포함된 모델을 설명하는 데만 집중
- 모델은 해결해야 하는 문제 없이 존재할 수 없다 -> 유비쿼터스 언어는 적용 가능한 컨텍스트 없이 정의하거나 사용할 수 x

#### 바운디드 컨텍스트의 범위
- 도메인 모델링: 모델 분할 -> 각 세분화된 모델에 적용 가능한 바운디드 컨텍스트를 정의
- 모델을 더 작은 바운디드 컨텍스트로 분해 가능
- 유비쿼터스 언어의 범위(바운디드 컨텍스트) 정의: 전략적 설계 의사결정
    - 비즈니스 도메인의 컨텍스트에 따라 넓히거나 더 작은 문제 도메인으로 세분화하여 좁힐 수 있다.
- 바운디드 컨텍스트의 크기 자체: 의사결정 요소 x 
- 모델의 크기: 정답은 없다, but 모델 자체로 유용해야 함

**큰 바운디드 컨텍스트 세분화**
- 새로운 sw engineering 팀 구성
- 일부 비기능 요구사항 해결
- 단일 바운디드 컨텍스트의 일부 컴포넌트 개발 수명주기를 분리
- 나머지 기능과 독립적으로 확장 가능

**결론:**
- 모델을 유용하게 유지하고, 바운디드 컨텍스트의 크기를 비즈니스 요구사항과 조직의 제약사항에 맞추기

**주의할 점**
- 같은 데이터에서 작동하는 응집된 유스케이스의 집합 / 기능을 여러개의 바운디드 컨텍스트로 분해하지 말기

---
### 바운디드 컨텍스트 vs 하위 도메인

#### 하위 도메인: 발견
- 상호 관련된 유스케이스 집합
- 비즈니스 도메인 & 시스템 요구사항에 따라 정의
- SW Engineer는 요구사항을 정의X, but 하위 도메인 식별을 위해 비즈니스 도메인을 분석한다.

#### 바운디드 컨텍스트: 설계
- SW Engineer에 의해 설계
- 전략적 설계 의사결정
- 비즈니스 도메인을 더 작고 관리 가능한 문제 도메인으로 어떻게 나눌지 정하는 것

#### 하위 도메인과 바운디드 컨텍스트 사이의 상호작용

**분해 전략**

1. 단일 모델을 전체 비즈니스 도메인에 적용: 모놀리식 바운디드 컨텍스트 
2. 유비쿼터스 언어의 일관성에 따라 나눈 바운디드 컨텍스트 (마케팅, 영업)
3. 바운디드 컨텍스트 : 하위 도메인 1:1 관계 : 하위 도메인 경계에 맞춰 나눈 바운디드 컨텍스트 (CRM, 회계, 전화 등)

**차이점**
- 하위 도메인: 발견
    - 비즈니스 전략에 의해 정의됨
- 바운디드 컨텍스트: 설계
    - 동일한 하위 도메인에 대한 다른 모델 사용 가능 (e.g: 지도 유형 별 다른 정보 제공)
    - 1:1 관계는 유연성 저하의 가능성 O

---
### 경계
바운디드 컨텍스트 패턴은 1)**물리적 경계**와 2)**소유권 경계를** **규정**하기 위한 도메인 주도 설계 **도구**다.

#### 물리적 경계
- 모델 경계뿐만 아니라 이를 **구현하는 시스템**의 **물리적 경계 역할**도 한다.
    - 각 바운디드 컨텍스트를 **개별 서비스/프로젝트**로 구현
    - 컨텍스트 별 독립적 구현, 진화, 버전 관리
    - 요구사항에 가장 적합한 기술 스택으로 구현 가능
    - 여러 하위 도메인 포함 가능
        - 바운디드 컨텍스트: 물리적 경계
        - 하위 도메인: 논리적 경계 (module, package 와 같은 다른 이름을 갖는다.)

#### 소유권 경계
- 바운디드 컨텍스트는 한 팀에서만 구현, 발전, 유지 관리해야 한다.
    - 두 팀이 같은 바운디드 컨텍스트에서 작업 X : 각 팀의 모델에 대한 암묵적 가정 제거
    - 서로 다른 컨텍스트로 분리된 모델과 시스템을 명시적으로 연동하기 위한 통신 프로토콜 정의
    - 팀:컨텍스트 -> 단방향 관계:  단일 팀이 한개 또는 여러 개의 바운디드 컨텍스트 소유 가능

---
### 실생활의 바운디드 컨텍스트


#### 시멘틱 도메인
바운디드 컨텍스트는 시멘틱 도메인의 사전적 개념에 기반- A specific place that shares a set of meanings, or a language that holds its meaning, within the given context of the place
/공간의 주어진 맥락 내에서 일련의 의미를 공유하는 특정 공간 또는 그 의미를 지닌 언어
- **의미 영역**과 해당 의미를 전달하기 위해 사용하는 **단어 영역**으로 구분
    - e.g.) 모니터, 포트, 프로세서 단어는 sw, hw engineering 시멘틱 도메인에서 서로 다른 의미를 갖는다.
    - e.g2) 토마토: 식물학적 정의 - 과일. 요리의 맥락: 채소.
        - 식물학의 바운디드 컨텍스트: 과일 / 요리의 바운디드 컨텍스트: 채소

##### 과학
- 모든 경우에 맞는 과학적 이론은 없으며, 다른 이론은 다른 맥락 안에서 유용하다.
- 중력 모델: 두 모델이 모순되는 것처럼 보이지만 둘 다 적절한 바운디드 컨텍스트에서 유용하다.

##### 냉장고
- 골판지 조각: 냉장고의 모델
- 모델은 실제 엔티티를 복사하는게 아닌 목적(해결해야 할 문제)이 있어야 한다.
- "이 모델은 어떤 문제를 해결하고자 하는가?"
    - Over-engineering: SW Engineering 관점에서 냉장고의 3D 모델을 만드는 것
- 같은 냉장고에 대한 두 가지 모델: 특정 작업(문제)에 최적화
    - 1) 골판지: 너비,깊이,크기를 확인하는 문제의 적절한 모델
    - 2) 줄자: 높이를 확인하는 문제의 적절한 모델
- 엄격한 바운디드 컨텍스트 존재
- 모델은 당면한 작업과 관련 없는 정보는 생략해야 한다.


---
### 결론
- 도메인 전문가의 멘탈 모델에 내재된 충돌을 발견할 때마다 유비쿼터스 언어를 여러 개 바운디드 컨텍스트로 분해
- 유비쿼터스 언어는 바운디드 컨텍스트의 범위 내에서 일관성이 있어야 한다.
- 바운디드 컨텍스트와 유비쿼터스 언어는 한 팀에서만 만들고 유지보수 할 수 있다. (여러 팀이 한개는 가능)
- 바운디드 컨텍스트는 시스템을 서비스, 하위 시스템 등의 물리적 구성요소로 분해한다.
- But 바운디드 컨텍스트는 시스템을 구성하기 위해 함께 작동해야 하며, 일부 변경은 다른 바운디드 컨텍스트에 영향을 줄 수 있다. -> 스스로를 보호하며 컨텍스트를 연동하기 위한 패턴 필요





