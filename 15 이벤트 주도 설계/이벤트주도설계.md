# Untitled

# 이벤트 주도 아키텍처

- 이벤트 주도 아키텍처는 도메인 주도 설계에서 사용되는 한가지의 방법
    - 도메인 주도 설계를 할 때 도메인 이벤트 라는 것이 생성됨
    - 도메인 이벤트는 이벤트 주도 아키텍처에서 유용하게 사용됨
- 시스템 컴포넌트가 이벤트 메시지를 교환하면서 비동기적으로 서로 커뮤니케이션하는 아키텍처 스타일
- 이벤트 소싱과의 차이점
    - 이벤트 소싱은 서비스 내부에서 발생한 이벤트를 처리
    - 이벤트 주도 아키텍처에서는 하나의 서비스에서 발생한 이벤트를 다른 서비스와 연동하기 위함

## 이벤트

---

### 이벤트, 커맨드, 메시지

- 이벤트
    - 이미 발생한 변화를 설명하는 메시지
    - 이벤트의 이름은 과거 시제로 표현해야함
    - 이벤트를 수신하는 쪽에서는 이벤트를 취소할 수 없음
- 커맨드
    - 수행되야 할 작업을 설명하는 메시지
    - 커맨드는 서비스의 상황에 따라 거부될 수 있다.

### 이벤트 유형

- 이벤트 알림
    - 다른 컴포넌트가 반응할 비즈니스 도메인의 변경에 관한 메시지
    - 다른 컴포넌트에게 이벤트 자체가 발생했다는 것을 알리는데 목적
    - 알림은 많은 정보를 가지고 있으면 안됨
        - 알림에 포함된 URL 등으로 더 자세한 세부 정보를 불러오는 형태
    - 이벤트 알림 시나리오를 사용하는 경우
        - 보안적으로 수신자가 세부 접근을 할 때 추가 권한 확인이 필요한 경우
        - 경쟁조건이 민감한 정보에 대해서 사용자에게 제일 최신 상태를 전달하기 위해
- 이벤트를 통한 상태 전송 (ECST)
    - 이벤트 publisher 의 내부 상태 변경사항을 메시지에 담음
    - ECST의 형태
        - 수정된 엔티티의 상태에 대한 완전한 스냅숏을 보냄
        - 실제로 수정된 필드만 이벤트에 담아서 보냄]
    - 이벤트로 들어온 정보를 통해 사용자의 상태를 계속해서 업데이트 할 수 있음
        - 이거를 또 로컬 캐시에 저장함
        - 따라서 원래 데이터 소스가 꺼져있더라도 캐시한 정보를 가지고 쓸 수 있기 때문에 가용성이 높아짐
- 도메인 이벤트
    - 6장에서 설명했던 도메인 이벤트 (라고 합니다)
        - 비즈니스 도메인에서 일어나는 이벤트를 설명하는 메시지
        - 필요한 서비스에서 이 메시지를 구독하고 consume
    - 이벤트 알림과의 차이
        - 도메인 이벤트에는 이벤트를 설명하는 모든 정보를 포함
        - 이벤트 알림은 다른 컴포넌트와 연동을 돕기 위해 설계됨
        - 도메인 이벤트는 비즈니스 도메인을 모델링 하기 위해 설계됨
    - 이벤트를 통한 상태 전송 과의 차이
        - ECST 메시지는 producer 데이터를 로컬 캐시로 보유하기에 충분한 정보를 제공
        - 도메인 이벤트 데이터는 너무 많은 정보를 노출해서는 안됨
        - ECST 처럼 애그리게이트의 상태를 성명하기 위한 것이 아니라 수명주기 동안 발생한 비즈니스 이벤트 자체에 대한 설명을 하기 위함

## 이벤트 주도 연동 설계

---

![Untitled](Untitled%20a71616489f014b10bce1b2146bf686c6/Untitled.png)

> 블라드 코노노프 피셜: Jonna 끔찍한 설계
> 

### 왜 와이?

- 시간 결합
    - 광고최적화와 리포팅 바운디드 컨텍스트는 시간적으로 결합됨
    - 리포팅 모듈이 트리거 되기 전에 광고 최적화 컴포넌트 처리가 완료되어야함
    - 하지만 다음과 같은 경우라면?
        - 광고최적화가 과부하로 5분 이내에 처리되지 못함
        - 네트워크 문제로 수신 메시지가 광고최적화 서비스로 전달되는 것이 지연될 수 있음
        - 광고 최적화 컴포넌트가 중단돼서 수진 메시지 처리가 중단될 수 있다.
- 기능결합
    - 마케팅과 광고최적화 바운디드 컨텍스드에서 똑같은 CRM 도메인 이벤트를 구독하고 고객 데이터를 프로젝션 했음 -> 두 바운디드 컨텍스트에서 동일한 형식으로 고객의 정보를 제시해야했기 때문
    - 컴포넌트 중 하나의 프로젝션이 변경된 경우 나머지 하나도 변경해야됨
- 구현 결합
    - CRM 구현의 변경사항이 발생하면 이걸 구독하는 모든 바운디드 컨텍스트에 반영해야함

![Untitled](Untitled%20a71616489f014b10bce1b2146bf686c6/Untitled%201.png)

> 블라드 코노노프 피셜: 이렇게만 해라
> 
- 구현결합과 기능결합을 낮추는 법
    - produce (CRM 바운디드 컨텍스트)의 프로젝션 로직을 캡슐화해서 결합도를 낮출 수 있음
    - 우리의 DTO 구조도 비슷한듯?
- 시간 결합을 낮추는 법
    - 광고최적화 컴포넌트가 이벤트 알림메시지를 발행해서 리포팅 모듈을 트리거

### 이벤트 주도 설계 휴리스틱

> 편집증 환자만 살아남는다
> 
- 메시지를 안정적으로 발송하기 위해 아웃박스 패턴을 사용
- 메시지를 발송할 때 subscriber 가 메시지 중복을 제거하고 순서가 잘못된 메시지를 식별하고 재정렬 할 수 있어야됨
- 보상 조치를 실행해야 하는 교차 바운디드 컨텍스트 프로세스를 조율할 때 사가 패턴과 프로세스 관리자 패턴을 활용 (?)

### 퍼블릭 이벤트와 프라이빗 이벤트

- 이벤트를 바운디드 컨텍스트의 퍼블릭 인터페이스의 내재된 부분으로 취급해야됨
- 바운디드 컨텍스트의 퍼블릭 인터페이스를 설계할 때 여러 유형의 이벤트를 활용해라
- 외부 바운디드 컨텍스트와 통신을 위한 도메인 이벤트는 최소화 해서 사용해라
    - 주로 퍼블릭 도메인 이벤트를 설계해라